window.map=null,window.addEventListener("load",()=>{restaurant.fetch(e=>{e?console.error(e):(restaurant.fillBreadcrumb(),window.setTabindex()),window.loaded=!0})}),window.initMap=(()=>{window.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:restaurant.item.latlng,scrollwheel:!1}),window.dbhelper.mapMarkerForRestaurant(restaurant.item),document.getElementById("map").removeEventListener("click",window.initMap)});class Restaurant{constructor(){this.item=null}fetch(e){if(this.item)return void e(null);const t=window.getParameterByName("id");t?window.dbhelper.fetchRestaurantById(t,(t,n)=>{this.item=n,this.item?(this.fillRestaurantHTML(),e(null)):console.error(t)}):e("No restaurant id in URL")}fillRestaurantHTML(){document.getElementById("restaurant-name").innerHTML=this.item.name;const e=document.getElementById("restaurant-fav-span"),t="true"===this.item.is_favorite||!0===this.item.is_favorite;t&&(e.className="is_fav"),e.innerHTML=t?"★":"☆",e.addEventListener("click",e=>{const t=e.target.classList.contains("is_fav");window.idb.setFavoriteById(this.item.id,!t).then(()=>{t?(e.target.classList.remove("is_fav"),e.target.innerHTML="☆"):(e.target.classList.add("is_fav"),e.target.innerHTML="★")})}),window.dbhelper.pictureForRestaurant(document.getElementById("restaurant-img"),this.item,"(max-width: 575px) 87.338vw, (max-width: 767px) 54.542vw, (max-width: 991px) 36.132vw, 36.835vw"),document.getElementById("restaurant-cuisine").innerHTML=this.item.cuisine_type,document.getElementById("restaurant-address").innerHTML=this.item.address,this.item.operating_hours&&this.fillRestaurantHoursHTML(),this.fillReviewsHTML(),document.getElementById("review-form-send").addEventListener("click",()=>{const e=document.getElementById("reviews-list");window.reviewIdb.sendReview({restaurant_id:this.item.id,name:document.getElementById("review-name").value,rating:document.getElementById("review-rating").value,comments:document.getElementById("review-text").value}).then(t=>{document.getElementById("review-form").reset(),e.appendChild(this.createReviewHTML(t))}).catch(t=>{t.updatedAt=Date.now(),document.getElementById("review-form").reset(),e.appendChild(this.createReviewHTML(t))})})}fillRestaurantHoursHTML(){const e=document.getElementById("restaurant-hours");for(let t in this.item.operating_hours){const n=document.createElement("tr"),i=document.createElement("td");i.innerHTML=t,n.appendChild(i);const a=document.createElement("td");a.innerHTML=this.item.operating_hours[t],n.appendChild(a),e.appendChild(n)}}fillReviewsHTML(){const e=document.getElementById("reviews-container");window.reviewIdb.getReviewByIndex("restaurant_id",this.item.id).then(e=>{const t=document.getElementById("reviews-list");e.forEach(e=>{t.appendChild(this.createReviewHTML(e))})}).catch(()=>{const t=document.createElement("p");t.innerHTML="No reviews yet!",e.appendChild(t)})}createReviewHTML(e){const t=document.createElement("li"),n=document.createElement("div"),i=document.createElement("p");i.className="reviewer-name",i.innerHTML=e.name,n.appendChild(i);const a=document.createElement("div"),r=document.createElement("p");r.className="reviewer-date";const d=new Date(e.updatedAt),s=e=>("0"+e).slice(-2);r.innerHTML=`${d.getFullYear()}.${s(d.getMonth()+1)}.${s(d.getDate())}. ${s(d.getHours())}:${s(d.getMinutes())}`,a.appendChild(r);const m=document.createElement("p");m.className="reviewer-rating",m.setAttribute("aria-label","Rating: "+e.rating+" of 5"),m.innerHTML=window.dbhelper.ratingHtmlForRestaurant(e.rating,!0),a.appendChild(m),n.appendChild(a),t.appendChild(n);const o=document.createElement("p");return o.className="reviewer-comment",o.innerHTML=e.comments,t.appendChild(o),t}fillBreadcrumb(){const e=document.getElementById("breadcrumb"),t=document.createElement("li");t.innerHTML=this.item.name,t.setAttribute("aria-current","page"),e.appendChild(t)}}const restaurant=new Restaurant;